{% extends 'layout.html' %} {% block content %}

<script type="text/javascript">
  var watchID;
  var geoLoc;
  var prevLocation = null;

  function showLocation(position) {
    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;

    var size = new google.maps.Size(6, 12);
    var myloc = new google.maps.Marker({
      clickable: false,
      icon: "./static/images/marker.png",
      shadow: null,
      zIndex: 999,
      scaledSize: size,
      map, // your google.maps.Map object
    });

    map.setCenter({ lat: latitude, lng: longitude });

    var me = new google.maps.LatLng(
      position.coords.latitude,
      position.coords.longitude
    );

    if (prevLocation === null) {
      prevLocation = myloc;
      map.setZoom(15);
    } else {
      prevLocation.setMap(null);
      prevLocation = myloc;
    }
    myloc.setPosition(me);

    $.ajax({
      type: "POST",
      url: "{{ url_for('get_recommendations') }}",
      contentType: "application/json",
      data: JSON.stringify({ latitude: latitude, longitude: longitude }),
      dataType: "json",
      success: function (response) {
        console.log(response);
      },
      error: function (err) {
        console.log(err);
      },
    });
    //  alert("Latitude : " + latitude + " Longitude: " + longitude);
  }

  function errorHandler(err) {
    if (err.code == 1) {
      alert("Error: Access is denied!");
    } else if (err.code == 2) {
      alert("Error: Position is unavailable!");
    }
  }

  function getLocationUpdate() {
    if (navigator.geolocation) {
      // timeout at 60000 milliseconds (60 seconds)
      var options = { timeout: 60000 };
      geoLoc = navigator.geolocation;
      watchID = geoLoc.watchPosition(showLocation, errorHandler, options);
    } else {
      alert("Sorry, browser does not support geolocation!");
    }
  }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script
  src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap&libraries=&v=weekly"
  defer
></script>

<div id="map"></div>
<div class="card" style="width: 100vw; height: 35%">
  <div class="card-body">
    <form>
      <input
        type="button"
        class="btn btn-primary btn-success"
        onclick="getLocationUpdate();"
        value="Start Tracking Location"
      />
    </form>
  </div>
</div>

{% endblock %}
