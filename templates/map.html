{% extends 'layout.html' %}

{% block content %}

<script type="text/javascript">
   var watchID;
   var geoLoc;

   function showLocation(position) {
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;
      console.log("hello");
      $.ajax({
         type: "POST",
         url: "{{ url_for('get_recommendations') }}",
         contentType: "application/json",
         data: JSON.stringify(
            {"latitude": latitude, "longitude": longitude}
         ),
         dataType: "json",
         success: function(response) {
            console.log(response);
         },
         error: function(err) {
            console.log(err);
         }
      });
      console.log("goodbye")
      alert("Latitude : " + latitude + " Longitude: " + longitude);
   }

   function errorHandler(err) {
      if (err.code == 1) {
         alert("Error: Access is denied!");
      } else if (err.code == 2) {
         alert("Error: Position is unavailable!");
      }
   }

   function getLocationUpdate() {

      if (navigator.geolocation) {

         // timeout at 60000 milliseconds (60 seconds)
         var options = { timeout: 60000 };
         geoLoc = navigator.geolocation;
         watchID = geoLoc.watchPosition(showLocation, errorHandler, options);
      } else {
         alert("Sorry, browser does not support geolocation!");
      }
   }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap&libraries=&v=weekly"
   defer></script>

<form>
   <input type="button" onclick="getLocationUpdate();" value="Watch Update" />
</form>
<div id="map"></div>

{% endblock %}